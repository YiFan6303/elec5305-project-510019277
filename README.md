# Instrument Classification Project â€” Full Usage Guide

This README explains exactly how to run the project, how to train the model, and how to test any audio file.

# ğŸ¬ Project Demo Video  
**Watch here:** (https://www.youtube.com/watch?v=k7hBRjcPYtQ)
Please set the playback quality to HD when watching, as it provides a much clearer presentation!
---

# 1. Project Structure

Your project directory should look like this:

```
project_root/
â”‚
â”œâ”€ dataset/                      # Training dataset (Philharmonia)
â”‚   â”œâ”€ cello/
â”‚   â”œâ”€ flute/
â”‚   â”œâ”€ oboe/
â”‚   â”œâ”€ trombone/
â”‚   â”œâ”€ tuba/
â”‚   â””â”€ ... (one folder per instrument)
â”‚
â”œâ”€ demo_data/                    # Test audio for demo 
â”‚   â”œâ”€ cello_A2_15_pianissimo_arco-normal.mp3
â”‚   â””â”€Unknown_Instrument
â”‚           â””â”€mandolin_As4_very-long_piano_normal.mp3
â”‚
â”œâ”€ results/
â”‚   â”œâ”€ ml/
â”‚   â”‚   â”œâ”€ philharmonia_features.mat      # Extracted features (auto-generated)
â”‚   â”‚   â”œâ”€ instrument_classifier.mat      # Trained ML model (auto-generated)
â”‚   â”‚   â””â”€ demo_segment_scores.csv        # Segment-level confidence output
â”‚   â””â”€ plots/ and audio/ generated by synthesis scripts
â”‚
â”œâ”€ src/
â”‚   â”œâ”€ feature extraction helpers
â”‚   â”œâ”€ additive & FM synthesis scripts
â”‚   â””â”€ utils (path handlers, etc.)
â”‚
â”œâ”€ extract_philharmonia_features.mlx
â”œâ”€ train_instrument_classifier.mlx
â”œâ”€ predict_instrument_demo.mlx
â”œâ”€ main_ml_pipeline.mlx
â””â”€ main_synthesis_demo.mlx
```

---

# 2. Software Requirements

- MATLAB R2025a  
- Audio Toolbox  
- Statistics and Machine Learning Toolbox  
- Signal Processing Toolbox  

---

# 3. How to Run the Full ML Pipeline
### **Step 1 **
Use the integrated pipeline:

1. Open MATLAB and set this folder as your working directory.
2. Run:

```matlab
main_synthesis_demo
```


After it finishes, you will have to:


run the 
```matlab
main_ml_pipeline
```

Then you need to run the 
```matlab
extract_philharmonia_features
```
to load all the test audio


Outputs:

```
results/ml/philharmonia_features.mat
```

---

### **Step 2 â€” Train classifier**

Next, you need to run the
```matlab
train_instrument_classifier
```
 
This script:

- Loads features  
- Splits train/test  
- Normalizes (z-score)  
- Trains RF / SVM / kNN / NB  
- Chooses best model (usually SVM-RBF)  
- Saves model:

```
results/ml/instrument_classifier.mat
```

---

# 4. Running the Demo (Test Any Audio)

This is the script that performs segment-wise classification:

```matlab
predict_instrument_demo
```

It will:

- Load saved classifier  
- Load test audio  
- Preprocess (trim silence + normalize)  
- Segment audio (0.8s windows)  
- Predict each segment  
- Use majority vote for final decision  
- Apply open-set detection (Unknown Instrument)  
- Generate:
  - waveform + spectrogram  
  - class-score heatmap  
  - time-axis segment labels  
  - CSV of segment scores  

---

# 5. How to Change the Test Audio

In `predict_instrument_demo.mlx`, find this line:

```matlab
testFile = "demo_data/Unknown_Instrument/saxophone_G3_phrase_mezzo-forte_staccato.mp3"; % Change to any test audio;
```

To test another known instrument:
You can open the 'demo_data' file to copy any audio's name, and then change to:

```matlab
testFile = "demo_data/ **paste the the audio name here**.mp3"; % Change to any test audio;
```

To test an unknown instrument (e.g., piano):
You can open the 'demo_data' file and then open the 'Unknown_Instrument' file to copy any audio's name, and then change to:
```matlab
testfile = "demo_data/Unknown_Instrument/ **paste the the audio name here** .mp3";
```
It is important to add 'Unknown_Instrument/' before the audio name when testing the unknnown instrument!

---

# 6. IMPORTANT â€” Testing Unknown Instruments

To correctly test unknown instruments:

### 1. Make sure the file is **NOT inside the `dataset/` directory**  
Otherwise MATLAB will treat it as a known class.

### 2. Put unknown audio inside:

```
demo_data/
```

### 3. Set path:

```matlab
testfile = "demo_data/Unknown_Instrument/mandolin_C5_very-long_piano_normal.mp3";
```

### 4. The system automatically applies:

- Low probability check  
- Voting consistency check  
- Mahalanobis distance check  

If the file does not resemble any trained class, output will be:

```
FINAL DECISION: Unknown Instrument
```

---

# 7. Replacing the Dataset (Optional)

If you want to change the training dataset:

### 1. Replace folders under:

```
dataset/
```

### 2. Ensure structure:

```
dataset/instrument_name2/*.mp3
```

### 3. Re-run:

```matlab
extract_philharmonia_features
train_instrument_classifier
```

---

# 8. Additive & FM Synthesis (Optional Part)

To run synthesis demos:

```matlab
main_synthesis_demo
```

Outputs:

```
results/audio/additive_A4.mp3
results/audio/fm_A4_r2_I4.mp3
```

These demonstrate harmonic structure differences between synthesis methods.

---

# 9. Summary of All Key Scripts

| Script | Purpose |
|-------|---------|
| `extract_philharmonia_features.mlx` | Extract timbre features from dataset |
| `train_instrument_classifier.mlx` | Train RF/SVM/kNN/NB and save best model |
| `main_ml_pipeline.mlx` | One-click pipeline (extract â†’ train â†’ evaluate) |
| `predict_instrument_demo.mlx` | Test audio classification + open-set detection |
| `main_synthesis_demo.mlx` | Additive vs FM synthesis comparison |
| `src/` | Helper functions, DSP tools, utilities |

---

# 10. Troubleshooting

### **Q1. Demo outputs â€œUnknown Instrumentâ€ for everything?**

- Test file too short (<0.3s after trimming)  
- Wrong sampling rate conversion  
- Heavy silence at start â†’ adjust silence threshold  

---

### **Q2. Feature extraction says â€œNo MFCCâ€?**

Check that Audio Toolbox is installed.

---

### **Q3. Results folder missing?**

All scripts auto-create required directories.

---

# 11. Author

Yi Fan (SID: 510019277)  
University of Sydney  
ELEC5305 â€“ Acoustics, Speech & Signal Processing
